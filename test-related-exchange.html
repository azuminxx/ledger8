<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€æ‹¬äº¤æ›ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f5f5f5; }
        .primary-key { background-color: #fff3e0; font-weight: bold; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #e0e0e0; border-radius: 5px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background-color: #e8f5e8; border-left: 4px solid #4caf50; }
        .error { background-color: #ffe8e8; border-left: 4px solid #f44336; }
        .info { background-color: #e3f2fd; border-left: 4px solid #2196f3; }
    </style>
</head>
<body>
    <h1>ğŸ”„ ä¸»ã‚­ãƒ¼äº¤æ›æ™‚ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€æ‹¬äº¤æ›ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª</h2>
        <ol>
            <li><strong>åº§å¸­ç•ªå·ã®äº¤æ›</strong>: A-001 â‡” B-002 ã‚’äº¤æ›ã™ã‚‹ã¨ã€åº§å¸­å°å¸³ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚ã™ã¹ã¦äº¤æ›ã•ã‚Œã‚‹</li>
            <li><strong>PCç•ªå·ã®äº¤æ›</strong>: PC-001 â‡” PC-002 ã‚’äº¤æ›ã™ã‚‹ã¨ã€PCå°å¸³ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚ã™ã¹ã¦äº¤æ›ã•ã‚Œã‚‹</li>
            <li><strong>ãƒ¬ã‚³ãƒ¼ãƒ‰IDäº¤æ›</strong>: ä¸»ã‚­ãƒ¼äº¤æ›æ™‚ã«ãƒ¬ã‚³ãƒ¼ãƒ‰IDã‚‚åŒæ™‚ã«äº¤æ›ã•ã‚Œã‚‹</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿</h2>
        <table id="test-table">
            <thead>
                <tr>
                    <th>è¡Œç•ªå·</th>
                    <th class="primary-key">åº§å¸­ç•ªå· [SEAT]</th>
                    <th class="primary-key">PCç•ªå· [PC]</th>
                    <th>åº§å¸­ã‚¨ãƒªã‚¢ [SEAT]</th>
                    <th>PCç”¨é€” [PC]</th>
                    <th>SEAT-ID</th>
                    <th>PC-ID</th>
                </tr>
            </thead>
            <tbody>
                <tr data-row-id="1" data-integration-key="SEAT:A-001|PC:PC-001">
                    <td>1</td>
                    <td class="primary-key" data-field-code="åº§å¸­ç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span>A-001</span>
                        </div>
                    </td>
                    <td class="primary-key" data-field-code="PCç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span>PC-002</span>
                        </div>
                    </td>
                    <td data-field-code="åº§å¸­ã‚¨ãƒªã‚¢">ãƒ•ãƒ­ã‚¢1-åŒ—</td>
                    <td data-field-code="PCç”¨é€”">å€‹äººå°‚ç”¨</td>
                    <td data-field-code="seat_record_id">SEAT-12345</td>
                    <td data-field-code="pc_record_id">PC-67890</td>
                </tr>
                <tr data-row-id="2" data-integration-key="SEAT:B-002|PC:PC-002">
                    <td>2</td>
                    <td class="primary-key" data-field-code="åº§å¸­ç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span>B-002</span>
                        </div>
                    </td>
                    <td class="primary-key" data-field-code="PCç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span>PC-002</span>
                        </div>
                    </td>
                    <td data-field-code="åº§å¸­ã‚¨ãƒªã‚¢">ãƒ•ãƒ­ã‚¢2-å—</td>
                    <td data-field-code="PCç”¨é€”">ä¼šè­°ç”¨</td>
                    <td data-field-code="seat_record_id">SEAT-54321</td>
                    <td data-field-code="pc_record_id">PC-09876</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>ğŸ“ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ­ã‚°</h2>
        <div id="test-log"></div>
        <button onclick="runTests()">ğŸš€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="clearLog()">ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <script>
        // ãƒ¢ãƒƒã‚¯ã®fieldsConfig
        window.fieldsConfig = [
            { fieldCode: 'åº§å¸­ç•ªå·', sourceApp: 'SEAT', isPrimaryKey: true },
            { fieldCode: 'PCç•ªå·', sourceApp: 'PC', isPrimaryKey: true },
            { fieldCode: 'åº§å¸­ã‚¨ãƒªã‚¢', sourceApp: 'SEAT', isRecordId: false },
            { fieldCode: 'PCç”¨é€”', sourceApp: 'PC', isRecordId: false },
            { fieldCode: 'seat_record_id', sourceApp: 'SEAT', isRecordId: true },
            { fieldCode: 'pc_record_id', sourceApp: 'PC', isRecordId: true }
        ];

        // ãƒ¢ãƒƒã‚¯ã®CellValueHelper
        window.CellValueHelper = {
            getValue: (cell) => {
                const span = cell.querySelector('span');
                return span ? span.textContent.trim() : cell.textContent.trim();
            },
            setValue: (cell, value) => {
                const span = cell.querySelector('span');
                if (span) {
                    span.textContent = value;
                } else {
                    cell.textContent = value;
                }
            }
        };

        // ãƒ¢ãƒƒã‚¯ã®CommonHighlightHelper
        window.CommonHighlightHelper = {
            updateMultipleCellsHighlight: (cells) => {
                cells.forEach(cell => {
                    cell.style.backgroundColor = '#fff3cd';
                });
                logResult('info', `ãƒã‚¤ãƒ©ã‚¤ãƒˆæ›´æ–°: ${cells.length}ã‚»ãƒ«ã‚’æ›´æ–°`);
            }
        };

        // ãƒ¢ãƒƒã‚¯ã®LedgerV2åå‰ç©ºé–“
        window.LedgerV2 = {
            TableInteract: {}
        };

        function logResult(type, message) {
            const log = document.getElementById('test-log');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }

        async function runTests() {
            logResult('info', 'ğŸ§ª ãƒ†ã‚¹ãƒˆé–‹å§‹: é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€æ‹¬äº¤æ›æ©Ÿèƒ½');
            
            try {
                // v2/cell-swap.jsã‚’å‹•çš„èª­ã¿è¾¼ã¿
                await loadScript('v2/cell-swap.js');
                
                // ãƒ†ã‚¹ãƒˆ1: åº§å¸­ç•ªå·ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—ãƒ†ã‚¹ãƒˆ
                testGetRelatedFields();
                
                // ãƒ†ã‚¹ãƒˆ2: ã‚»ãƒ«æ¤œç´¢ãƒ†ã‚¹ãƒˆ
                testFindCellInRow();
                
                // ãƒ†ã‚¹ãƒˆ3: å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰äº¤æ›ãƒ†ã‚¹ãƒˆ
                testExchangeSingleField();
                
                logResult('success', 'âœ… å…¨ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                logResult('error', `âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    logResult('success', `âœ… ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${src}`);
                    resolve();
                };
                script.onerror = () => {
                    logResult('error', `âŒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å¤±æ•—: ${src}`);
                    reject(new Error(`Failed to load ${src}`));
                };
                document.head.appendChild(script);
            });
        }

        function testGetRelatedFields() {
            logResult('info', 'ğŸ” ãƒ†ã‚¹ãƒˆ1: é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—');
            
            const manager = new window.LedgerV2.TableInteract.CellSwapManager();
            
            // SEATå°å¸³ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            const seatFields = manager._getRelatedFields('SEAT');
            logResult('info', `SEATé–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [${seatFields.join(', ')}]`);
            
            // PCå°å¸³ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            const pcFields = manager._getRelatedFields('PC');
            logResult('info', `PCé–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [${pcFields.join(', ')}]`);
            
            if (seatFields.includes('åº§å¸­ã‚¨ãƒªã‚¢') && pcFields.includes('PCç”¨é€”')) {
                logResult('success', 'âœ… é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—ãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
            } else {
                logResult('error', 'âŒ é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—ãƒ†ã‚¹ãƒˆ: å¤±æ•—');
            }
        }

        function testFindCellInRow() {
            logResult('info', 'ğŸ” ãƒ†ã‚¹ãƒˆ2: ã‚»ãƒ«æ¤œç´¢');
            
            const manager = new window.LedgerV2.TableInteract.CellSwapManager();
            const row = document.querySelector('tr[data-row-id="1"]');
            
            const seatCell = manager._findCellInRow(row, 'åº§å¸­ç•ªå·');
            const pcCell = manager._findCellInRow(row, 'PCç•ªå·');
            
            if (seatCell && pcCell) {
                logResult('success', 'âœ… ã‚»ãƒ«æ¤œç´¢ãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
                logResult('info', `åº§å¸­ç•ªå·ã‚»ãƒ«å€¤: ${window.CellValueHelper.getValue(seatCell)}`);
                logResult('info', `PCç•ªå·ã‚»ãƒ«å€¤: ${window.CellValueHelper.getValue(pcCell)}`);
            } else {
                logResult('error', 'âŒ ã‚»ãƒ«æ¤œç´¢ãƒ†ã‚¹ãƒˆ: å¤±æ•—');
            }
        }

        function testExchangeSingleField() {
            logResult('info', 'ğŸ” ãƒ†ã‚¹ãƒˆ3: å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰äº¤æ›');
            
            const manager = new window.LedgerV2.TableInteract.CellSwapManager();
            const row1 = document.querySelector('tr[data-row-id="1"]');
            const row2 = document.querySelector('tr[data-row-id="2"]');
            
            const seat1 = manager._findCellInRow(row1, 'åº§å¸­ç•ªå·');
            const seat2 = manager._findCellInRow(row2, 'åº§å¸­ç•ªå·');
            
            const before1 = window.CellValueHelper.getValue(seat1);
            const before2 = window.CellValueHelper.getValue(seat2);
            
            logResult('info', `äº¤æ›å‰: ${before1} â‡” ${before2}`);
            
            // äº¤æ›å®Ÿè¡Œ
            manager._exchangeSingleField(seat1, seat2);
            
            const after1 = window.CellValueHelper.getValue(seat1);
            const after2 = window.CellValueHelper.getValue(seat2);
            
            logResult('info', `äº¤æ›å¾Œ: ${after1} â‡” ${after2}`);
            
            if (after1 === before2 && after2 === before1) {
                logResult('success', 'âœ… å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰äº¤æ›ãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
            } else {
                logResult('error', 'âŒ å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰äº¤æ›ãƒ†ã‚¹ãƒˆ: å¤±æ•—');
            }
        }
    </script>
</body>
</html> 