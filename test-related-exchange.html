<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€æ‹¬äº¤æ›ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f5f5f5; }
        .primary-key { background-color: #fff3e0; font-weight: bold; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #e0e0e0; border-radius: 5px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background-color: #e8f5e8; border-left: 4px solid #4caf50; }
        .error { background-color: #ffe8e8; border-left: 4px solid #f44336; }
        .info { background-color: #e3f2fd; border-left: 4px solid #2196f3; }
        
        /* ä¸»ã‚­ãƒ¼æœªç´ã¥ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .cell-unlinked-ledger {
            background-color: #f5f5f5 !important;
        }
        
        /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰éš ã™ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆDOMä¸Šã«ã¯å­˜åœ¨ã€è¦–è¦šçš„ã«éè¡¨ç¤ºï¼‰ */
        .cell-hidden-from-user {
            width: 1px !important;
            min-width: 1px !important;
            max-width: 1px !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            overflow: hidden !important;
            font-size: 0 !important;
            color: transparent !important;
            background: transparent !important;
            opacity: 0.01 !important;
            pointer-events: none !important;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã§ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰éš ã™ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .header-hidden-from-user {
            width: 1px !important;
            min-width: 1px !important;
            max-width: 1px !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            overflow: hidden !important;
            font-size: 0 !important;
            color: transparent !important;
            background: transparent !important;
            opacity: 0.01 !important;
        }
    </style>
</head>
<body>
    <h1>ğŸ”„ ä¸»ã‚­ãƒ¼äº¤æ›æ™‚ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€æ‹¬äº¤æ›ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª</h2>
        <ol>
            <li><strong>åº§å¸­ç•ªå·ã®äº¤æ›</strong>: A-001 â‡” B-002 ã‚’äº¤æ›ã™ã‚‹ã¨ã€åº§å¸­å°å¸³ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚ã™ã¹ã¦äº¤æ›ã•ã‚Œã‚‹</li>
            <li><strong>PCç•ªå·ã®äº¤æ›</strong>: PC-001 â‡” PC-002 ã‚’äº¤æ›ã™ã‚‹ã¨ã€PCå°å¸³ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚ã™ã¹ã¦äº¤æ›ã•ã‚Œã‚‹</li>
            <li><strong>ãƒ¬ã‚³ãƒ¼ãƒ‰IDäº¤æ›</strong>: ä¸»ã‚­ãƒ¼äº¤æ›æ™‚ã«ãƒ¬ã‚³ãƒ¼ãƒ‰IDã‚‚åŒæ™‚ã«äº¤æ›ã•ã‚Œã‚‹</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿</h2>
        <table id="test-table">
            <thead>
                <tr>
                    <th>è¡Œç•ªå·</th>
                    <th class="primary-key">åº§å¸­ç•ªå· [SEAT]</th>
                    <th class="primary-key">PCç•ªå· [PC]</th>
                    <th>åº§å¸­ã‚¨ãƒªã‚¢ [SEAT]</th>
                    <th>PCç”¨é€” [PC]</th>
                    <th>SEAT-ID</th>
                    <th>PC-ID</th>
                </tr>
            </thead>
            <tbody>
                <tr data-row-id="1" data-integration-key="SEAT:A-001|PC:PC-001">
                    <td>1</td>
                    <td class="primary-key" data-field-code="åº§å¸­ç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span>A-001</span>
                        </div>
                    </td>
                    <td class="primary-key" data-field-code="PCç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span>PC-002</span>
                        </div>
                    </td>
                    <td data-field-code="åº§å¸­ã‚¨ãƒªã‚¢">ãƒ•ãƒ­ã‚¢1-åŒ—</td>
                    <td data-field-code="PCç”¨é€”">å€‹äººå°‚ç”¨</td>
                    <td data-field-code="seat_record_id">SEAT-12345</td>
                    <td data-field-code="pc_record_id">PC-67890</td>
                </tr>
                <tr data-row-id="2" data-integration-key="SEAT:B-002|PC:PC-002">
                    <td>2</td>
                    <td class="primary-key" data-field-code="åº§å¸­ç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span>B-002</span>
                        </div>
                    </td>
                    <td class="primary-key" data-field-code="PCç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span>PC-002</span>
                        </div>
                    </td>
                    <td data-field-code="åº§å¸­ã‚¨ãƒªã‚¢">ãƒ•ãƒ­ã‚¢2-å—</td>
                    <td data-field-code="PCç”¨é€”">ä¼šè­°ç”¨</td>
                    <td data-field-code="seat_record_id">SEAT-54321</td>
                    <td data-field-code="pc_record_id">PC-09876</td>
                </tr>
                <tr data-row-id="3" data-integration-key="SEAT:C-003">
                    <td>3</td>
                    <td class="primary-key" data-field-code="åº§å¸­ç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span>C-003</span>
                        </div>
                    </td>
                    <td class="primary-key" data-field-code="PCç•ªå·" data-is-primary-key="true" draggable="true">
                        <div style="display: flex; align-items: center;">
                            <span></span>
                        </div>
                    </td>
                    <td data-field-code="åº§å¸­ã‚¨ãƒªã‚¢">ãƒ•ãƒ­ã‚¢3-æ±</td>
                    <td data-field-code="PCç”¨é€”"></td>
                    <td data-field-code="seat_record_id">SEAT-98765</td>
                    <td data-field-code="pc_record_id"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>ğŸ“ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ­ã‚°</h2>
        <div id="test-log"></div>
        <button onclick="runTests()">ğŸš€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="clearLog()">ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        <button onclick="testUnlinkedLedgerStyle()">ğŸ¨ ä¸»ã‚­ãƒ¼ç´ã¥ããƒ†ã‚¹ãƒˆ</button>
        <button onclick="testHiddenFields()">ğŸ‘ï¸â€ğŸ—¨ï¸ éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ</button>
    </div>

    <!-- v2ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script src="v2/utils.js"></script>
    <script src="v2/table-render.js"></script>

    <script>
        // ãƒ¢ãƒƒã‚¯ã®fieldsConfig
        window.fieldsConfig = [
            { fieldCode: 'åº§å¸­ç•ªå·', sourceApp: 'SEAT', isPrimaryKey: true },
            { fieldCode: 'PCç•ªå·', sourceApp: 'PC', isPrimaryKey: true },
            { fieldCode: 'åº§å¸­ã‚¨ãƒªã‚¢', sourceApp: 'SEAT', isRecordId: false },
            { fieldCode: 'PCç”¨é€”', sourceApp: 'PC', isRecordId: false },
            { fieldCode: 'seat_record_id', sourceApp: 'SEAT', isRecordId: true, isHiddenFromUser: true },
            { fieldCode: 'pc_record_id', sourceApp: 'PC', isRecordId: true, isHiddenFromUser: true }
        ];

        // ãƒ¢ãƒƒã‚¯ã®CellValueHelper
        window.CellValueHelper = {
            getValue: (cell) => {
                const span = cell.querySelector('span');
                return span ? span.textContent.trim() : cell.textContent.trim();
            },
            setValue: (cell, value) => {
                const span = cell.querySelector('span');
                if (span) {
                    span.textContent = value;
                } else {
                    cell.textContent = value;
                }
            }
        };

        // ãƒ¢ãƒƒã‚¯ã®CommonHighlightHelper
        window.CommonHighlightHelper = {
            updateMultipleCellsHighlight: (cells) => {
                cells.forEach(cell => {
                    cell.style.backgroundColor = '#fff3cd';
                });
                logResult('info', `ãƒã‚¤ãƒ©ã‚¤ãƒˆæ›´æ–°: ${cells.length}ã‚»ãƒ«ã‚’æ›´æ–°`);
            }
        };

        // ãƒ¢ãƒƒã‚¯ã®LedgerV2åå‰ç©ºé–“
        window.LedgerV2 = {
            TableInteract: {}
        };

        // ãƒ¢ãƒƒã‚¯ã®FieldValueProcessor
        window.FieldValueProcessor = {
            process: (record, fieldCode, defaultValue) => {
                return record[fieldCode] || defaultValue;
            }
        };

        // ãƒ¢ãƒƒã‚¯ã®StyleManager
        window.StyleManager = {
            applyCellStyles: (cell, width) => {
                cell.style.width = width;
            }
        };

        // ãƒ¢ãƒƒã‚¯ã®DOMHelper
        window.DOMHelper = {
            getTableBody: () => document.querySelector('#test-table tbody')
        };

        function logResult(type, message) {
            const log = document.getElementById('test-log');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }

        async function runTests() {
            logResult('info', 'ğŸ§ª ãƒ†ã‚¹ãƒˆé–‹å§‹: é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€æ‹¬äº¤æ›æ©Ÿèƒ½');
            
            try {
                // v2/cell-swap.jsã‚’å‹•çš„èª­ã¿è¾¼ã¿
                await loadScript('v2/cell-swap.js');
                
                // ãƒ†ã‚¹ãƒˆ1: åº§å¸­ç•ªå·ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—ãƒ†ã‚¹ãƒˆ
                testGetRelatedFields();
                
                // ãƒ†ã‚¹ãƒˆ2: ã‚»ãƒ«æ¤œç´¢ãƒ†ã‚¹ãƒˆ
                testFindCellInRow();
                
                // ãƒ†ã‚¹ãƒˆ3: å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰äº¤æ›ãƒ†ã‚¹ãƒˆ
                testExchangeSingleField();
                
                // ãƒ†ã‚¹ãƒˆ4: ç©ºè¡Œåˆ¤å®šãƒ†ã‚¹ãƒˆ
                testEmptyRowDetection();
                
                // ãƒ†ã‚¹ãƒˆ5: ç©ºè¡Œå‰Šé™¤ãƒ†ã‚¹ãƒˆï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
                testEmptyRowRemoval();
                
                logResult('success', 'âœ… å…¨ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                logResult('error', `âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    logResult('success', `âœ… ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${src}`);
                    resolve();
                };
                script.onerror = () => {
                    logResult('error', `âŒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å¤±æ•—: ${src}`);
                    reject(new Error(`Failed to load ${src}`));
                };
                document.head.appendChild(script);
            });
        }

        function testGetRelatedFields() {
            logResult('info', 'ğŸ” ãƒ†ã‚¹ãƒˆ1: é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—');
            
            const manager = new window.LedgerV2.TableInteract.CellSwapManager();
            
            // SEATå°å¸³ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            const seatFields = manager._getRelatedFields('SEAT');
            logResult('info', `SEATé–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [${seatFields.join(', ')}]`);
            
            // PCå°å¸³ã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            const pcFields = manager._getRelatedFields('PC');
            logResult('info', `PCé–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [${pcFields.join(', ')}]`);
            
            if (seatFields.includes('åº§å¸­ã‚¨ãƒªã‚¢') && pcFields.includes('PCç”¨é€”')) {
                logResult('success', 'âœ… é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—ãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
            } else {
                logResult('error', 'âŒ é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—ãƒ†ã‚¹ãƒˆ: å¤±æ•—');
            }
        }

        function testFindCellInRow() {
            logResult('info', 'ğŸ” ãƒ†ã‚¹ãƒˆ2: ã‚»ãƒ«æ¤œç´¢');
            
            const manager = new window.LedgerV2.TableInteract.CellSwapManager();
            const row = document.querySelector('tr[data-row-id="1"]');
            
            const seatCell = manager._findCellInRow(row, 'åº§å¸­ç•ªå·');
            const pcCell = manager._findCellInRow(row, 'PCç•ªå·');
            
            if (seatCell && pcCell) {
                logResult('success', 'âœ… ã‚»ãƒ«æ¤œç´¢ãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
                logResult('info', `åº§å¸­ç•ªå·ã‚»ãƒ«å€¤: ${window.CellValueHelper.getValue(seatCell)}`);
                logResult('info', `PCç•ªå·ã‚»ãƒ«å€¤: ${window.CellValueHelper.getValue(pcCell)}`);
            } else {
                logResult('error', 'âŒ ã‚»ãƒ«æ¤œç´¢ãƒ†ã‚¹ãƒˆ: å¤±æ•—');
            }
        }

        function testExchangeSingleField() {
            logResult('info', 'ğŸ” ãƒ†ã‚¹ãƒˆ3: å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰äº¤æ›');
            
            const manager = new window.LedgerV2.TableInteract.CellSwapManager();
            const row1 = document.querySelector('tr[data-row-id="1"]');
            const row2 = document.querySelector('tr[data-row-id="2"]');
            
            const seat1 = manager._findCellInRow(row1, 'åº§å¸­ç•ªå·');
            const seat2 = manager._findCellInRow(row2, 'åº§å¸­ç•ªå·');
            
            const before1 = window.CellValueHelper.getValue(seat1);
            const before2 = window.CellValueHelper.getValue(seat2);
            
            logResult('info', `äº¤æ›å‰: ${before1} â‡” ${before2}`);
            
            // äº¤æ›å®Ÿè¡Œ
            manager._exchangeSingleField(seat1, seat2);
            
            const after1 = window.CellValueHelper.getValue(seat1);
            const after2 = window.CellValueHelper.getValue(seat2);
            
            logResult('info', `äº¤æ›å¾Œ: ${after1} â‡” ${after2}`);
            
            if (after1 === before2 && after2 === before1) {
                logResult('success', 'âœ… å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰äº¤æ›ãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
            } else {
                logResult('error', 'âŒ å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰äº¤æ›ãƒ†ã‚¹ãƒˆ: å¤±æ•—');
            }
        }

        function testEmptyRowDetection() {
            logResult('info', 'ğŸ” ãƒ†ã‚¹ãƒˆ4: ç©ºè¡Œåˆ¤å®š');
            
            const manager = new window.LedgerV2.TableInteract.CellSwapManager();
            
            // è¡Œ1ï¼ˆå€¤ã‚ã‚Šï¼‰ã®ç©ºè¡Œåˆ¤å®š
            const row1 = document.querySelector('tr[data-row-id="1"]');
            const isEmpty1 = manager._isRowEmpty(row1);
            logResult('info', `è¡Œ1 ç©ºè¡Œåˆ¤å®š: ${isEmpty1 ? 'ç©ºè¡Œ' : 'å€¤ã‚ã‚Š'}`);
            
            // è¡Œ3ï¼ˆåº§å¸­ã®ã¿ã€PCã¯ç©ºï¼‰ã®ç©ºè¡Œåˆ¤å®š
            const row3 = document.querySelector('tr[data-row-id="3"]');
            const isEmpty3 = manager._isRowEmpty(row3);
            logResult('info', `è¡Œ3 ç©ºè¡Œåˆ¤å®š: ${isEmpty3 ? 'ç©ºè¡Œ' : 'å€¤ã‚ã‚Š'}`);
            
            // ç©ºè¡Œãƒ†ã‚¹ãƒˆç”¨ã®è¡Œã‚’ä½œæˆ
            const emptyRow = createEmptyTestRow();
            const isEmptyTest = manager._isRowEmpty(emptyRow);
            logResult('info', `ãƒ†ã‚¹ãƒˆç©ºè¡Œ åˆ¤å®š: ${isEmptyTest ? 'ç©ºè¡Œ' : 'å€¤ã‚ã‚Š'}`);
            
            if (!isEmpty1 && !isEmpty3 && isEmptyTest) {
                logResult('success', 'âœ… ç©ºè¡Œåˆ¤å®šãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
            } else {
                logResult('error', 'âŒ ç©ºè¡Œåˆ¤å®šãƒ†ã‚¹ãƒˆ: å¤±æ•—');
            }
        }

        function testEmptyRowRemoval() {
            logResult('info', 'ğŸ” ãƒ†ã‚¹ãƒˆ5: ç©ºè¡Œå‰Šé™¤ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰');
            
            const manager = new window.LedgerV2.TableInteract.CellSwapManager();
            
            // ç©ºè¡Œãƒ†ã‚¹ãƒˆç”¨ã®è¡Œã‚’ä½œæˆã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ 
            const emptyRow = createEmptyTestRow();
            emptyRow.setAttribute('data-row-id', '999');
            document.querySelector('#test-table tbody').appendChild(emptyRow);
            
            logResult('info', 'ç©ºè¡Œã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ ');
            
            // å‰Šé™¤å‰ã®è¡Œæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            const rowsBefore = document.querySelectorAll('#test-table tbody tr').length;
            logResult('info', `å‰Šé™¤å‰ã®è¡Œæ•°: ${rowsBefore}`);
            
            // ç©ºè¡Œå‰Šé™¤å®Ÿè¡Œ
            manager._removeEmptyRowsAfterExchange([emptyRow]);
            
            // å‰Šé™¤å¾Œã®è¡Œæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            const rowsAfter = document.querySelectorAll('#test-table tbody tr').length;
            logResult('info', `å‰Šé™¤å¾Œã®è¡Œæ•°: ${rowsAfter}`);
            
            if (rowsAfter === rowsBefore - 1) {
                logResult('success', 'âœ… ç©ºè¡Œå‰Šé™¤ãƒ†ã‚¹ãƒˆ: æˆåŠŸ');
            } else {
                logResult('error', 'âŒ ç©ºè¡Œå‰Šé™¤ãƒ†ã‚¹ãƒˆ: å¤±æ•—');
            }
        }

        function createEmptyTestRow() {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>999</td>
                <td class="primary-key" data-field-code="åº§å¸­ç•ªå·" data-is-primary-key="true">
                    <div style="display: flex; align-items: center;">
                        <span></span>
                    </div>
                </td>
                <td class="primary-key" data-field-code="PCç•ªå·" data-is-primary-key="true">
                    <div style="display: flex; align-items: center;">
                        <span></span>
                    </div>
                </td>
                <td data-field-code="åº§å¸­ã‚¨ãƒªã‚¢"></td>
                <td data-field-code="PCç”¨é€”"></td>
                <td data-field-code="seat_record_id"></td>
                <td data-field-code="pc_record_id"></td>
            `;
            return row;
        }

        function testUnlinkedLedgerStyle() {
            logResult('info', 'ğŸ¨ ä¸»ã‚­ãƒ¼ç´ã¥ããƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
                const testRecords = [
                    {
                        integrationKey: 'SEAT:A-001|PC:PC-001',
                        'åº§å¸­ç•ªå·': 'A-001',
                        'PCç•ªå·': 'PC-001',
                        'åº§å¸­ã‚¨ãƒªã‚¢': 'ãƒ•ãƒ­ã‚¢1-åŒ—',
                        'PCç”¨é€”': 'å€‹äººå°‚ç”¨',
                        'seat_record_id': 'SEAT-12345',
                        'pc_record_id': 'PC-67890'
                    },
                    {
                        integrationKey: 'SEAT:C-003',
                        'åº§å¸­ç•ªå·': 'C-003',
                        'PCç•ªå·': '', // ç©ºã®ä¸»ã‚­ãƒ¼
                        'åº§å¸­ã‚¨ãƒªã‚¢': 'ãƒ•ãƒ­ã‚¢3-æ±',
                        'PCç”¨é€”': '', // ç©ºã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
                        'seat_record_id': 'SEAT-98765',
                        'pc_record_id': '' // ç©ºã®é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
                    }
                ];
                
                // ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½œæˆ
                if (window.LedgerV2 && window.LedgerV2.TableRender && window.LedgerV2.TableRender.TableDisplayManager) {
                    const tableManager = new window.LedgerV2.TableRender.TableDisplayManager();
                    
                    // å„ãƒ¬ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨ã‚’ãƒ†ã‚¹ãƒˆ
                    testRecords.forEach((record, index) => {
                        const row = document.querySelector(`#test-table tbody tr[data-row-id="${index + 1}"]`);
                        if (row) {
                            // ã‚»ãƒ«ã«data-source-appå±æ€§ã‚’è¿½åŠ ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
                            const cells = row.querySelectorAll('td');
                            cells.forEach((cell, cellIndex) => {
                                const fieldCode = cell.getAttribute('data-field-code');
                                if (fieldCode) {
                                    const field = window.fieldsConfig.find(f => f.fieldCode === fieldCode);
                                    if (field && field.sourceApp) {
                                        cell.setAttribute('data-source-app', field.sourceApp);
                                    }
                                }
                            });
                            
                            // ä¸»ã‚­ãƒ¼ç´ã¥ãã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
                            tableManager._applyUnlinkedLedgerStyles(row, record);
                            
                            logResult('success', `âœ… è¡Œ${index + 1}: ä¸»ã‚­ãƒ¼ç´ã¥ããƒã‚§ãƒƒã‚¯å®Œäº†`);
                        }
                    });
                    
                    // çµæœç¢ºèª
                    const unlinkedCells = document.querySelectorAll('.cell-unlinked-ledger');
                    logResult('info', `ğŸ¯ ã‚°ãƒ¬ãƒ¼èƒŒæ™¯ã‚»ãƒ«æ•°: ${unlinkedCells.length}å€‹`);
                    
                    if (unlinkedCells.length > 0) {
                        logResult('success', 'âœ… ä¸»ã‚­ãƒ¼æœªç´ã¥ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚°ãƒ¬ãƒ¼èƒŒæ™¯åŒ–æˆåŠŸï¼');
                    } else {
                        logResult('error', 'âŒ ã‚°ãƒ¬ãƒ¼èƒŒæ™¯ãŒé©ç”¨ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                    }
                } else {
                    logResult('error', 'âŒ TableDisplayManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
            } catch (error) {
                logResult('error', `âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
            }
        }

        function testHiddenFields() {
            logResult('info', 'ğŸ‘ï¸â€ğŸ—¨ï¸ éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // ãƒ¬ã‚³ãƒ¼ãƒ‰IDãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’DOMä¸Šã§ç¢ºèª
                const seatRecordIdCells = document.querySelectorAll('[data-field-code="seat_record_id"]');
                const pcRecordIdCells = document.querySelectorAll('[data-field-code="pc_record_id"]');
                
                logResult('info', `ğŸ” seat_record_id ã‚»ãƒ«æ•°: ${seatRecordIdCells.length}å€‹`);
                logResult('info', `ğŸ” pc_record_id ã‚»ãƒ«æ•°: ${pcRecordIdCells.length}å€‹`);
                
                // éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’é©ç”¨
                seatRecordIdCells.forEach(cell => {
                    cell.classList.add('cell-hidden-from-user');
                });
                pcRecordIdCells.forEach(cell => {
                    cell.classList.add('cell-hidden-from-user');
                });
                
                // å€¤ã‚’ç¢ºèªï¼ˆDOMä¸Šã«ã¯å­˜åœ¨ï¼‰
                seatRecordIdCells.forEach((cell, index) => {
                    const value = cell.textContent.trim();
                    logResult('success', `âœ… seat_record_id[${index}] DOMå€¤: "${value}" (è¦–è¦šçš„ã«éš ã‚Œã¦ã„ã‚‹)`);
                });
                
                pcRecordIdCells.forEach((cell, index) => {
                    const value = cell.textContent.trim();
                    logResult('success', `âœ… pc_record_id[${index}] DOMå€¤: "${value}" (è¦–è¦šçš„ã«éš ã‚Œã¦ã„ã‚‹)`);
                });
                
                // è¦–è¦šçš„ãªç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                if (seatRecordIdCells.length > 0 || pcRecordIdCells.length > 0) {
                    logResult('success', 'âœ… éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é©ç”¨å®Œäº†ï¼ãƒ¬ã‚³ãƒ¼ãƒ‰IDã¯DOMä¸Šã«å­˜åœ¨ã™ã‚‹ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã¯è¦‹ãˆã¾ã›ã‚“');
                    logResult('info', 'ğŸ’¡ é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§è¦ç´ ã‚’ç¢ºèªã™ã‚‹ã¨ã€å€¤ã¯å­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™');
                } else {
                    logResult('error', 'âŒ éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }
                
            } catch (error) {
                logResult('error', `âŒ éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
            }
        }
    </script>
</body>
</html> 